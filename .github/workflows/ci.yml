name: 🛞 continuous-integration

on:
  pull_request:
    branches: [main]

jobs:
  detect-changes:
    name: 🔎 Detect Changes
    runs-on: ubuntu-latest
    outputs:
      require-jest: ${{ steps.changes.outputs.js || steps.changes.outputs.tests }}
      require-e2e2: ${{ steps.changes.outputs.action }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4.1.1
      - name: Paths Changes Filter
        uses: dorny/paths-filter@v2.11.1
        id: changes
        with:
          filters: |
            js:
              - 'index.js|package.json|package-lock.json|functions/**'
            tests:
              - 'tests/**'
            action:
              - 'action.yml'

  test-JS:
    name: 🧪 Test JS changes
    needs: detect-changes
    if: needs.detect-changes.outputs.require-jest == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4.1.1

      - name: install packages
        run: npm install

      - name: run tests
        run: npm run test-ci

      - name: Test Report
        uses: dorny/test-reporter@v1
        if: success() || failure()
        with:
          name: JEST Tests # Name of the check run which will be created
          path: reports/jest-*.xml
          reporter: jest-junit
