name: ðŸš€ continuous-delivery

on:
  push:
    branches:
      - main

jobs:
  semver:
    name: ðŸš€ release new version
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4.1.1
      with:
          token: ${{ secrets.GH_AUTOMATION_TOKEN }}

    - name: release new version
      uses: cangulo-actions/semver@main
      id: semver
      with:
        create-gh-release: true
        print-summary: true

    - name: add semver output to GH summary
      uses: actions/github-script@v7
      env:
        SEMVER_OUTPUTS: ${{ toJson(steps.semver.outputs) }}
      with:
        script: |
          const semverOutputs = JSON.parse(process.env.SEMVER_OUTPUTS)

          console.log('semverOutputs', semverOutputs)

          core.summary
            .addHeading('Semver Output:')
            .addCodeBlock(JSON.stringify(semverOutputs, null, 2), 'json')
            .write()      
    