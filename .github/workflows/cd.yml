name: ðŸš€ continuous-delivery

on:
  push:
    branches:
      - main

permissions: read-all

jobs:
  semver:
    name: ðŸš€ release new version
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7
        with:
          token: ${{ secrets.CANGULO_BOT_PUSH_COMMITS }} # required for pushing to main, it is a protected branch

      - name: release new version
        uses: ./
        id: semver
        with:
          configuration: .github/semver.yml
          create-gh-release: true
          github-token: ${{ secrets.CANGULO_BOT_PUSH_COMMITS }}
          print-summary: true
          print-annotations: true
          include-previous-non-releasable-commits: false

      - name: add semver output to GH summary
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea # v7.0.1
        env:
          SEMVER_OUTPUTS: ${{ toJson(steps.semver.outputs) }}
        with:
          script: |
            const semverOutputs = JSON.parse(process.env.SEMVER_OUTPUTS)

            console.log('semverOutputs', semverOutputs)

            core.summary
              .addHeading('Semver Output:')
              .addCodeBlock(JSON.stringify(semverOutputs, null, 2), 'json')
              .write()

# refresh 20240112-2
